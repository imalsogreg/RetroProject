
PROGRAM:
    behav

DESCRIPTION:
    Computes positional and directional correlates to unit activity
    from one or more unit clusters. Can look for time-shifted 
    correlations between unit activity and behavior.

AUTHOR:
    Written by Matthew Wilson
    ARL Division of Neural Systems, Memory, and Aging
    University of Arizona
    Tucson, AZ 85724
    wilson@nsma.arizona.edu

DATES:
    original 5/91
    program update 9/91
    documentation update 11/91


USAGE:
    behav pfile [-t file] [-ts file msec] 
        [-o file] [-vo variancefile] [-do dirfile] [-oo occupancyfile]
	[-events] [-intervals] [-ithresh low hi]
	[-grid] [-dgrid mintheta maxtheta] [-dvector]
	[-normalize 0/1] [-correlations] [-samplebias] [-zerofiring] 
	[-nonzerofiring] [-reliability] [-occgrid] [-occrategrid] 
	[-bin msec] [-dsize #] [-xysize #] [-xsize #] [-ysize #]
        [-xoffset pixels] [-yoffset pixels]
	[-tstart time] [-tend time] [-sstart spike#] [-send spike#]
	[-look lookahead] [-maxgap n] [-radtest min max]
	[-inf infinity] [-occlimit time] [-v]

OPTIONS:
    Note that spaces between options and arguments are important.
    Order of the arguments is not important. All arguments and options
    must be placed on a single line (no carriage returns).

INPUT FILE OPTIONS:
    pfile
	This is the name of the data file containing timestamped, dual-xy,
	positional information. This file can be created from a 
	Brainwave(tm) uff file using the 'uffextract' program.
	This is not optional and must be specified. Only one position
	file can be specified on the command line. 

	DEFAULT: none. Required argument.
	
    -t tfile
    -ts tfile msec	
	These options specify time files, to be used as sources of spike times.
	These times will be correlated with the timestamped positional 
	information stored in the required pfile.
	If the -ts option is used all times in the time file will be 
	shifted by the specified amount prior to calculation of any 
	behavioral correlate. Note that multiple time files can be
	placed on the same command line (each preceded by the
	-t or -ts option). This will have the effect of 
	computing the combined correlation of position and
	multiple (possibly timeshifted) unit activity.
	There is a limit of 10 time files which cannot be exceeded without
	recompilation. (no fundamental restriction, 10 just seemed a
	reasonable maximum)

	DEFAULT: none

	TFILE FORMAT:
	The tfile is a binary file consisting of sequential unsigned
	long integers corresponding to the 4 byte timestamps
	maintained in the Brainwave(tm) uff files. A unit timestamp
	represents 100 usec.

OUTPUT FILE OPTIONS:
    The output files generated by specifying this options are affected
    by the selection of grid/position options '-grid', '-dgrid' and '-dvector'.
    In grid mode these files consist of an 'xview' formatted binary file 
    which can be viewed using the xview display program.
    In vector mode these files consist of ascii data which can be viewed 
    using the 'xplot' program.

    -o file
	Specifies the file to which the basic correlated output will be saved. 
	In vector mode this consists of an ascii file with
	spike count/rate binned with respect to direction.
	In grid mode this consists of an 'xview' formatted binary file with
	spike count/rate binned with respect to xy position.

	DEFAULT: output to stdout (the terminal).

    -vo file
	Specifies the file to which the standard error of the
	each positional/directional bins is placed. 

	DEFAULT: no variance output

    -do file
	Outputs an ascii file containing directional/velocity information
	for each sampled position for which valid direction/velocity can
	be computed. 

	OUTPUT FILE FORMAT:
	Each row corresponds to the time of a valid position sample.
	The columns of the ascii file contain the following information:

	timestamp direction flip[0/1] gap vang1 vmag1 vang2 vmag2 vdiff

	    timestamp - timestamp of the position sample in units of 100 usec. 

	    direction - angle in degrees computed from the positions of the
		front and back diodes.

	    flip - 0 indicates that the diode 1,2 remain unchanged 
		(front diode = 1, back diode = 2)
		1 indicates that diode 1,2 were swapped.
		(front diode = 2, back diode = 1)

	    vang1 - angle of the velocity vector computed for the front diode
		based on the change in position from the previous position 
		sample.

	    vmag1 - magnitude of the velocity vector computed for the front 
		diode based on the change in position from the previous 
		position sample.

	    vang2, vmag2 - same as vang1,vmag1 only for the back diode

	    vdiff - flags significant angular discrepancy between computed 
		direction and linear velocity vector. 

	DEFAULT: no direction output

    -oo file
	Outputs data for each occupancy in the form of an ascii file
	containing the following information:

	x y direction rate interval

	    x - x position in pixels
	    y - y position in pixels
	    direction - head direction in degrees
	    rate - firing rate over the occupancy interval in spikes/sec
	    interval - occupancy interval duration in 100 usec units.

	DEFAULT: no occupancy output

EVENT DEFINITION OPTIONS:
    -events
	The default event is the occurrence of a spike. The output will 
	reflect the number of spike events which occurred within 
	positional/directional bins.  Spikes are binned into a 
	position/direction if the time of occurrence is >= the timestamp 
	of the previous position sample (valid or not) and < the timestamp 
	of the current position sample.

	DEFAULT: true

    -interval
	This defines the event as the interval between the current spike
	and the previous spike.
	The output will reflect the cumulative interval between spikes
	which occurred within positional/directional bins. Note that
	only intervals in which both spikes occurred between the
	previous and current position sample time (see above) are counted. 

	DEFAULT: false
	    
    -ithresh low high
	This defines an event as an interval which lies between the
	low and high time values (msec). Intervals are as defined in 
	the -interval option. The output is the cumulative number of such 
	windowed interval events which occurred within 
	positional/directional bins. Specifying -1 for either the low or
	high values indicates no lower or upper bounds test respectively.

	DEFAULT: false

ANALYSIS FORMAT OPTIONS:
    These options determine the form of binning which will be used to
    compile results. 

    -grid
	Selects output in the form of 2 dimensional xy histogram which
	is used to compute positional correlations.

	DEFAULT: true

    -dgrid mintheta maxtheta
	Selects output in the form of 2 dimensional xy histogram which
	is used to compute positional correlations within the specified
	directional range.

	DEFAULT: false

    -dvector
	Selects output in the form of a 1 dimensional histogram used to
	contain directional correlations.

	DEFAULT: false

ANALYSIS RESULTS OPTIONS:
    These options define the type of data computed and saved to the output 
    files specified by the -o and -vo options. All of these options, with
    the exception of -normalize, are mutually exclusive.

    -normalize 0/1
	This option specifies whether or not cumulative results for
	positional/directional bins are normalized based on number of 
	samples/occupancies. This can be used in conjunction with the
	remaining options.

	DEFAULT: true

    -correlations
	By default the output is in the form of cumulative correlational events
	which can be normalized. The standard error of this measure can be
	obtained with the -vo option.

	DEFAULT: true

    -reliability
	computes the ratio of cumulative non-zero correlational events to
	total number of correlational events. Cannot be normalized.

	DEFAULT: false

    -nonzerofiring
	computes the cumulative number of non-zero correlational events as 
	a function of position/direction. Cannot be normalized.

	DEFAULT: false

    -zerofiring
	computes the cumulative number of zero correlational events as 
	a function of position/direction. Cannot be normalized.

	DEFAULT: false

    -samplebias
	computes the cumulative number of positional/directional samples 
	as a function of position/direction. Cannot be normalized.
	
	DEFAULT: false

    -occgrid
	computes the cumulative number of occupancies as a function of
	position/direction. Cannot be normalized.
	
	DEFAULT: false

    -occrategrid
	computes the cumulative firing rate over all occupancies as a
	function of position/direction. This can be normalized by the
	total number of occupancies to obtain mean firing rate over
	occupancy.
	The standard error of the normalized rate per occupancy is also
	computed and can be obtained with the -vo option.

	DEFAULT: false

BINNING OPTIONS:

    -bin msec
	specifies the time interval over which cumulative position/direction
	information should be compiled before writing to the output files. 
	Specifying a binsize less than the entire data interval will result in 
	successive output frames placed in the single output file.

	DEFAULT: entire data interval

    -dsize
	specifies the number of bins used for vector output (number of
	directional bins over 360 degrees).

	DEFAULT: 360

    -xsize
	specifies the number of bins in the x dimension for grid output

	DEFAULT: 256

    -ysize
	specifies the number of bins in the y dimension for grid output

	DEFAULT: 256

    -xysize
	specifies the number of bins in the x and y dimension for grid output

	DEFAULT: 256

    -xoffset
	number of pixels (or whatever the xy positional units are) to 
	shift x positional values.

	DEFAULT: 0

    -yoffset
	number of pixels (or whatever the xy positional units are) to 
	shift y positional values.

	DEFAULT: 0

DATA RANGE OPTIONS:
    These options restrict analysis to a subset of the spiketime data.
    Note that these options do not affect the position procesing/statistics 
    such as diode corrections (flips) which are evaluated over all 
    available positional samples.

    -tstart time
	This sets the time (msec) from which spike event analysis will begin. 
	All spikes occurring prior to this time will be ignored. 

	DEFAULT: beginning of data set

    -tend time
	This sets the time (msec) at which spike event analysis will end. 
	All spikes occurring after to this time will be ignored. 

	DEFAULT: end of data set

    -sstart spike#
    -send spike#
	Identical to -tstart and -tend only starting and ending points are 
	specified based on absolute spike number rather than on time.
	

DIODE EVALUATION/CORRECTION (FLIPS) OPTIONS:
    -look maxlookahead
	specifies the maximum number of positional intervals to be scanned
	when evaluating flips. The algoritm determines which flipped state
	of the current dual-xy positional information will result in the
	minimum number of flipped states over the subsequent maxlookahead 
	number of intervals. Note that this specifies the number of 
	SAMPLED positions intervals so that changes in position
	sampling rate and missing positional samples will change the
	effective time spanned by the lookahead.

	DEFAULT: 500

    -maxgap n
	This specifies the maximum tolerable gap in valid position/direction
	samples in number of intervals. Gaps longer than this interval
	force diode correction evaluation (flips). Additionally, velocity
	will not be calculated over the gap interval.

	DEFAULT: 3

    -radtest min max
	This specifies the minimum and maximum distance, inclusive, between 
	front and back diodes which can be tolerated before being considered
	invalid for purposes of position/direction calculation. The units
	are in pixels (or whatever the units of the xy data are given in).

	DEFAULT: min=8, max=30

MISCELLANEOUS OPTIONS:
    -usage
	displays the list of available options.

    -version
	displays the version number of the program

    -v
	this option turns on verbose mode which will display more extensive
	status information during data processing.

	DEFAULT: not verbose

    -inf value
	this option specifies the value to be assigned to the results of
	calculations which result in a value of infinity, such as divide
	by zero which typically occurs when normalizing position/direction
	bins which have zero occupancy.

	DEFAULT: 0

    -occlimit maxtime
	This option specifies the maximum duration of an occupancy interval.
	Intervals exceeding this value will be assigned the maximum value
	and events occurring beyond this interval will be ignored.
	Note maxtime is given in units of msec.

	DEFAULT: no limit

NOTES:
    EVALUATION OF INVALID POSITIONS:
	A position sample is considered invalid for purposes of computing
	position, direction, and velocity if any of the following
	conditions are met:
	    CONDITION: (0,0) on diode 1	
	    RESULT: increment invalid front diode count
	    CONDITION: (0,0) on diode 2	
	    RESULT: increment invalid back diode count
	    CONDITION: distance between diodes is less than the minimum 
		radius or greater than the maximum radius
	    RESULT: increment exceeded radius count

    EVALUATION OF INVALID DIRECTIONS:
	A direction is considered invalid if any of the above conditions
	are met and the following additional condition is found:
	    CONDITION: (x1,y1) == (x2,y2)
	    RESULT: increment missing direction count

    EVALUATION OF INVALID VELOCITIES:
	A velocity is considered invalid if any of the conditions listed
	above for invalid position are met and the gap in valid positions 
	exceeds the maximum specified gap length (in absolute time).

    OCCUPANCY EVALUATION:
	Occupancy is defined as the period of time during which the xy position
	remains unchanged, and the direction changes less than a specified
	amount (45 degrees). The occurrence of an invalid position/direction
	also terminates an occupancy. Sufficient direction change is
	evaluated based on fixed-compass 45 degree bins. Change of direction
	from one 45 degree bin to another consitutes grounds for
	termination of occupancy.

    Cumulative statistics concerning the processing of the positional
    data is output to stderr (the terminal) upon completion of analysis.

EXAMPLES:

    Given positional data file 'pdata1' and spiketime data files 'tdata1'
    and 'tdata2' the xy spatial firing bias of spikes in tdata1 could
    be computed with the following command:

	behav pdata1 -t tdata1 -grid -xysize 20 -o grid.out

    The output will be in the form of a 'xview' compatible binary
    data file which can be viewed with the 'xview' program. There will
    be 20 spatial bins in x and y. 

    The directional firing bias as a function of position over the
    range of 0 to 45 degrees could be computed using:

	behav pdata1 -t tdata1 -dgrid 0 45 -xysize 20 -o dgrid0-45.out

    The total directional firing bias independent of position could be
    computed with:

	behav pdata1 -t tdata1 -dvector -dsize 100 -o dir.out

    The output would be in the form of an ascii file with the normalized
    spike event count as a function of direction with a 3.6 degree binsize.

    To compute the time-shifted correlation between spike data 'tdata1' and
    future position 1 sec after firing
	
	behav pdata1 -ts tdata1 1000 -grid -xysize 20 -o gridpredict.out

    To compute multiple unit time-shifted correlation between spikes
    tdata1 and tdata2 and position 

	behav pdata1 -t tdata1 -ts tdata2 10 -grid -xysize 20 -o grid12.out

